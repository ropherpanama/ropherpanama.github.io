
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Apuntes - Tuning Glassfish (Optimización Para Producción) - El blog del xobi</title>
  <meta name="author" content="Rosendo Ropher">

  
  <meta name="description" content="Apuntes - Tuning Glassfish (Optimización Para Producción) Sep 29th, 2015 11:20 am Ajuste de JVM Ya que Glassfish está hecho sobre Java, muchas de &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ropherpanama.github.io/blog/2015/09/29/tuning-de-glassfish/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="El blog del xobi" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">-->
<!--<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">-->
<link href='https://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><!--<hgroup>                                                      -->
<!--  <h1><a href="/">El blog del xobi</a></h1>     -->
<!--                                        -->
<!--    <h2>Mi diario vivir sobre Java, Android, Ruby, Python, Oracle, JavaScript y mucho más ...</h2>                              -->
<!--                                                   -->
<!--</hgroup>                                                     -->

<hgroup>
<header class="section section-primary section-header">
	<!--<header class="logo">
		<img src="http://leveluplunch.com/images/leveluplunch.svg" alt="Level Up Lunch">
		<h2 class="logo-slogan">learn. code. eat.</h2>
	</header> -->
 
	<div class="container">
		<h1 class="title">El blog del xobi</h1>
		<div class="subtitle">Mi diario vivir sobre Java, Android, Ruby, Python, Oracle, JavaScript y mucho más ...</div>
	</div>
</header>
</hgroup>
</header>
  <main class="container">
		<nav role="navigation"><!-- <ul class="subscription" data-subscription="rss">                       -->
<!--   <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>                   -->
<!--                                                                                                            -->
<!-- </ul>                                                                                                                 -->
<!--                                                                                           -->
<!-- <form action="https://www.google.com/search" method="get">                                                                -->
<!--   <fieldset role="search">                                                                                           -->
<!--     <input type="hidden" name="sitesearch" value="ropherpanama.github.io">                                   -->
<!--     <input class="search" type="text" name="q" results="0" placeholder="Buscar"/>                                    -->
<!--   </fieldset>                                                                                                        -->
<!-- </form>                                                                                                              -->
<!--                                                                                                           -->
<!--<ul class="nav">                                                  -->
<!--  <li><a href="/">Blog</a></li>                     -->
<!--  <li><a href="/blog/archives">Archivos</a></li>    -->
<!--</ul>                                                             -->

<div class="nav">
      <ul>
        <li><a href="/">Blog</a></li>
		<li><a href="/blog/archives">Archivos</a></li>
        <li class="contact"><a href="/about">Sobre mí</a></li>
      </ul>
</div>
</nav>
		<div id="main">
			<div id="content">
				<div>
<article class="post" role="article">
  
  <header>
    
      <h1 class="post-title">Apuntes - Tuning Glassfish (Optimización Para Producción)</h1>
    
    
      <p class="post-info">
        




<time class='entry-date' datetime='2015-09-29T11:20:00-05:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:20 am</span></time>
        
      </p>
    
  </header>


<div class="post-excerpt"><h3>Ajuste de JVM</h3>

<p>Ya que Glassfish está hecho sobre Java, muchas de las optimizaciones pueden hacerse a través de la Java Virtual Machine</p>

<p>En el fichero <code>domain.xml</code> ubicado en <code>%GLASSFISH_HOME%/glassfish/domains/&lt;DOMAIN_NAME/config</code> se deben editar los parametro <code>Xms</code> y <code>Xmx</code>, esto para reservar más memoria para el GF.</p>

<!--more-->


<p>Ubica los siguientes parámetros y modifícalos según la necesidad y capacidad del servervidor que aloja tu aplicación:</p>

<p><code>&lt;jvm-options&gt;-Xmx1024m&lt;/jvm-options&gt;</code> y <code>&lt;jvm-options&gt;-Xms1024m&lt;/jvm-options&gt;</code></p>

<p>En este caso se está asignando 1GB de RAM, ambos parámetros se colocan igual para asignar la memoria en el arranque del servicio, de esta forma no se pierde tiempo haciéndolo después.</p>

<p>Modificar la opción <code>-client</code> por <code>-server</code> de la siguiente manera, si el servidor que ejecuta el GF es 64bits entonces por default tomará la opción correcta, pero nada se pierde con “asegurarnos":<code>&lt;jvm-options&gt;-server&lt;/jvm-options&gt;</code></p>

<p>También incluir estas configuraciones <code>-Xss128k</code>, <code>-XX:+DisableExplicitGC</code>, <code>-XX:ParallelGCThreads=N</code> (en donde N es el número de CPU&rsquo;s del servidor si la cantidad es menor a 8, en caso contrario N es igual #CPU&rsquo;s/2)</p>

<p><code>-XX:+UseParallelOldGC</code></p>

<p>Si la aplicación está haciendo una gran cantidad de operaciones de E/S como escritura, también se le puede decir a <code>Grizzly</code> que utilice una estrategia asíncrona:</p>

<p><code>-Dcom.sun.grizzly.http.asyncwrite.enabled=true</code></p>

<p>Una alternativa que podría considerarse también si se está notando que algunas operaciones de escritura parecen tomar más tiempo de lo esperado.  Se puede aumentar el número de procesadores de escritura al aumentar el número Selectors NIO:</p>

<p><code>-Dcom.sun.grizzly.maxSelectors=XXX</code></p>

<p>Si la aplicación será utilizada por dispostivos móviles o a través de redes lentas puede configurar:</p>

<p><code>-Dcom.sun.grizzly.readTimeout</code>
o
<code>network-config&gt;network-listeners&gt;network-listener&gt;transport#read-timeout</code> para las operaciones read y <code>com.sun.grizzly.writeTimeout o network-config&gt;network-listeners&gt;network-listener&gt;transport#write-timeout</code> para las operaciones write.</p>

<p>Para que un hilo no bloquee otros posibles procesos de I/O durante mucho tiempo puede configurar la opción:</p>

<p><code>-Dcom.sun.grizzly.useKeepAliveAlgorithm=true</code></p>

<p>Esto le dará oportunidad de ejecución a otras peticiones.</p>

<h3>GlassFish Tuning</h3>

<p>Algunas configuraciones en el servidor de aplicaciones en sí, pueden ser las siguientes:</p>

<p>En el mismo fichero <code>domain.xml</code> modificar las siguientes opciones como se muestra a continuación:</p>

<ol>
<li>Evitemos el autodeploy y la recarga dinámica, esto toma tiempo y no es deseable, configuramos lo siguiente: <code>&lt;das-config autodeploy-enabled="false" dynamic-reload-enabled="false"&gt;&lt;/das-config&gt;</code></li>
<li>Aceptor Threads: Si se tiene por ejemplo, un servidor con 2 CPU&rsquo;s de 4 núcleos cada uno, el valor de este parámetro debe ser 8. Para configurarlo ve a la consola de administración y busca la siguiente direccion <code>Configuration -&gt; Network Config -&gt; Transports -&gt; tcp -&gt; Acceptor threads</code></li>
<li>Cacheo de recursos estáticos: <code>Configuration -&gt; Network Config -&gt; Protocols -&gt; http-listener-1 -&gt; File Cache -&gt; Enabled</code>. De tener conexiones HTTPS habilitarlo también para el listener seguro.</li>
<li>Si el servidor solo posee un Network Interface Card (NIC) reemplaza todos los valores <code>0.0.0.0</code> de  los http listeners con el IP del servidor, como se muestra <code>Configuration -&gt; Network Config -&gt; Network Listeners -&gt; &lt;listener_name&gt; -&gt; Address</code></li>
<li><p>Modificar el fichero <code>default-web.xml</code> ubicado en <code>%GLASSFISH_HOME%/glassfish/domains/&lt;DOMAIN_NAME&gt;/config</code> como se muestra:</p>

<pre><code> &lt;servlet&gt;
 &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
 &lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt;
     &lt;init-param&gt;
         &lt;param-name&gt;development&lt;/param-name&gt;
         &lt;param-value&gt;false&lt;/param-value&gt;
     &lt;/init-param&gt;
     &lt;init-param&gt;
         &lt;param-name&gt;genStrAsCharArray&lt;/param-name&gt;
         &lt;param-value&gt;true&lt;/param-value&gt;
     &lt;/init-param&gt;
     ...
 &lt;/servlet&gt;
</code></pre></li>
</ol>


<h3>Optimizaciones para JDBC</h3>

<p>Para drivers JDBC de Oracle pueden configurarse las siguientes opciones:</p>

<ul>
<li><code>ImplicitCachingEnabled=true</code></li>
<li><code>MaxStatements=200</code></li>
<li>Configurar los valores del Pool de conexiones <code>steady-pool-size</code> y <code>max-pool-size</code> con el mismo valor. Una regla general es configurar estos valores con el mismo número que se ha configurado en los <code>HTTP request processing threads</code></li>
</ul>


<p>Sobre la marcha seguimos trabajando con Glassfish (ahora en su versión 4) y estos ajustes seguro que se irán actualizando.</p>

<p>A todos un saludo!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Escrito por <span class="fn">Rosendo Ropher</span></span>

      




<time class='entry-date' datetime='2015-09-29T11:20:00-05:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:20 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/glassfish/'>glassfish</a>, <a class='category' href='/blog/categories/javaee/'>javaee</a>, <a class='category' href='/blog/categories/oracle/'>oracle</a>
  
</span>


    </p>
    
      <!-- <div class="sharing">                                                                                                                                                                                -->
<!--                                                                                                                                                                    -->
<!--   <a href="//twitter.com/share" class="twitter-share-button" data-url="http://ropherpanama.github.io/blog/2015/09/29/tuning-de-glassfish/" data-via="ropherpanama" data-counturl="http://ropherpanama.github.io/blog/2015/09/29/tuning-de-glassfish/" >Tweet</a>      -->
<!--                                                                                                                                                                                           -->
<!--                                                                                                                                                                         -->
<!--   <div class="g-plusone" data-size="medium"></div>                                                                                                                          -->
<!--                                                                                                                                                                                           -->
<!--                                                                                                                                                                                           -->
<!-- </div>                                                                                                                                                                                               -->

<footer class=sharing>
	<p>
		<b>Compártelo:</b> 
			<a href="https://twitter.com/share" class="btn btn-social btn-twitter" data-url="http://ropherpanama.github.io/blog/2015/09/29/tuning-de-glassfish/" data-via="ropherpanama" data-counturl="http://ropherpanama.github.io/blog/2015/09/29/tuning-de-glassfish/"><i class=icon-twitter></i> Twitter</a> 
			<a href="https://www.facebook.com/sharer/sharer.php?u=http://ropherpanama.github.io/blog/2015/09/29/tuning-de-glassfish/" class="btn btn-social btn-facebook" ><i class=icon-facebook></i> Facebook</a> 
			<a href="https://plus.google.com/share?url=http://ropherpanama.github.io/blog/2015/09/29/tuning-de-glassfish/" class="btn btn-social btn-google"><i class=icon-google></i> Google+</a>
	</p>
</footer>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/09/27/some-awesome-title/" title="Previous Post: Threads Java: iniciarlos, detenerlos y reanudarlos (básico)">&laquo; Threads Java: iniciarlos, detenerlos y reanudarlos (básico)</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/09/29/android-primer-ejemplo/" title="Next Post: Introducción a Android con un ejemplo (y no es HelloWorld)">Introducción a Android con un ejemplo (y no es HelloWorld) &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    




  
</aside>


			</div>
		</div>
	</main>
  <footer role="contentinfo"><footer class="section section-dark">
	<div class=container>
		
		<div class=row>
			<div class="col col-half footer-area footer-area-left">
				<ul class=nav-inline>
					<li><a href="/">Blog</a></li>
					<li><a href="/blog/archives">Archivos</a></li>
					<li><a href="/about">Sobre mí</a></li>
					<li><a href="http://www.leveluplunch.com/styleguide/" target="_blank">Style Guide</a></li>
				</ul>
			</div>
		</div>
		
		<div class=row>
			<div class="col col-half footer-area footer-area-left">
				<p style="color:#000000;">
					Copyright &copy; 2015 - Rosendo Ropher -
					<span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
				</p>
			</div>
			<div class="col col-half footer-area footer-area-right">
				<a href=https://twitter.com/ropherpanama class=social-link title=Twitter><span class=sr-only>Twitter</span> <i class=icon-twitter-white></i></a> 
				<a href=https://www.facebook.com/RopherHernandez?fref=ts class=social-link title=Facebook><span class=sr-only>Facebook</span> <i class=icon-facebook-white></i></a> 
				<a href=https://plus.google.com/u/0/+RosendoPe%C3%B1aHern%C3%A1ndez rel=publisher class=social-link title=Google+><span class=sr-only>google+</span> <i class=icon-google-white></i></a> 
				<a href=https://github.com/ropherpanama class=social-link title=GitHub><span class=sr-only>GitHub</span> <i class=icon-github></i></a> 
				<a href=http://www.youtube.com/user/RosendoRopher class=social-link title=YouTube><span class=sr-only>YouTube</span> <i class=icon-youtube></i></a>
			</div>
		</div>
	</div>
</footer>
</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
